<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
    integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
    integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>

  <script src="/static/js/auth.js"></script>

  <style>
    :root {
      --bg: #0b1220;
      --card: rgba(255, 255, 255, 0.06);
      --card2: rgba(255, 255, 255, 0.08);
      --border: rgba(255, 255, 255, 0.12);
      --text: rgba(255, 255, 255, 0.88);
      --muted: rgba(255, 255, 255, 0.6);
      --accent: #7dd3fc;
      --accent2: #a78bfa;
      --good: #34d399;
    }

    body {
      margin: 0;
      min-height: 100vh;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(125, 211, 252, 0.18), transparent 55%),
        radial-gradient(900px 500px at 80% 0%, rgba(167, 139, 250, 0.18), transparent 55%),
        radial-gradient(900px 500px at 60% 100%, rgba(52, 211, 153, 0.10), transparent 55%),
        var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB",
        "Microsoft YaHei", Arial, sans-serif;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 16px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(125, 211, 252, 0.18), rgba(167, 139, 250, 0.18));
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      backdrop-filter: blur(10px);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 18px;
      letter-spacing: .2px;
    }

    .brand-badge {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 25px rgba(167, 139, 250, 0.25);
    }

    .content {
      margin-top: 16px;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 16px;
    }

    @media (max-width: 980px) {
      .content {
        grid-template-columns: 1fr;
      }
    }

    .card {
      border-radius: 16px;
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.22);
      backdrop-filter: blur(10px);
      overflow: hidden;
    }

    .card-header {
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .card-title {
      font-weight: 700;
      margin: 0;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      letter-spacing: .3px;
    }

    .card-body {
      padding: 16px;
    }

    .profile {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .avatar {
      width: 62px;
      height: 62px;
      border-radius: 18px;
      object-fit: cover;
      border: 1px solid var(--border);
      background: rgba(255, 255, 255, 0.06);
    }

    .kv {
      margin-top: 14px;
      display: grid;
      gap: 10px;
    }

    .kv-item {
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--card2);
      border: 1px solid var(--border);
    }

    .kv-label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .kv-value {
      font-size: 14px;
      font-weight: 700;
      color: var(--good);
      word-break: break-all;
      margin: 0;
    }

  
    .toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      width: 100%;
    }

    .toolbar .hint {
      font-size: 12px;
      color: var(--muted);
    }

    
    .table-wrap {
      padding: 0 16px 16px 16px;
    }

    #filetbl {
      width: 100%;
      margin: 0;
      border-collapse: separate;
      border-spacing: 0 10px;
    }

    #filetbl thead th {
      font-size: 12px;
      color: var(--muted);
      font-weight: 600;
      padding: 10px 12px;
      border: none;
    }

    #filetbl tbody tr {
      background: rgba(255, 255, 255, 0.06);
      border: 1px solid var(--border);
    }

    #filetbl tbody td {
      padding: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      vertical-align: middle;
      color: rgba(255, 255, 255, 0.88);
      font-size: 13px;
    }

    #filetbl tbody tr td:first-child {
      border-left: 1px solid rgba(255, 255, 255, 0.05);
      border-top-left-radius: 14px;
      border-bottom-left-radius: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: rgba(255, 255, 255, 0.78);
    }

    #filetbl tbody tr td:last-child {
      border-right: 1px solid rgba(255, 255, 255, 0.05);
      border-top-right-radius: 14px;
      border-bottom-right-radius: 14px;
    }

   
    .btn.btn-success {
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background-image: none !important;
      background: linear-gradient(135deg, rgba(52, 211, 153, 0.95), rgba(125, 211, 252, 0.95)) !important;
      color: #071018 !important;
      font-weight: 700;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.20);
    }

    .btn.btn-success:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }

    .btn.btn-success:active {
      transform: translateY(0px);
    }

   
    .table-scroll {
      overflow-x: auto;
      padding-bottom: 8px;
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="topbar">
      <div class="brand">
        <div class="brand-badge"></div>
        <div>Have a plant that attack as the team</div>
      </div>
      <div style="font-size:12px;color:rgba(255,255,255,.7);">
        Dream big • Start small • Just do it
      </div>
    </div>

    <div class="content">
    
      <div class="card">
        <div class="card-header">
          <p class="card-title">Profile</p>
        </div>
        <div class="card-body">
          <div class="profile">
            <img class="avatar" src="/static/img/avatar.jpeg" alt="avatar" />
            <div>
              <div style="font-weight:800;font-size:15px;">Welcome back</div>
              <div style="font-size:12px;color:var(--muted);margin-top:2px;">
                Turn your wounds into wisdom.
              </div>
            </div>
          </div>

          <div class="kv">
            <div class="kv-item">
              <div class="kv-label">username</div>
              <p id="username" class="kv-value">-</p>
            </div>
            <div class="kv-item">
              <div class="kv-label">signuptime</div>
              <p id="regtime" class="kv-value" style="color: rgba(255,255,255,.86);font-weight:600;">-</p>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="toolbar">
            <div>
              <p class="card-title" style="margin-bottom:2px;">File list</p>
              <div class="hint">Showing latest 15 files</div>
            </div>
            <button class="btn btn-success" onclick="toUploadFile()">
              upload file
            </button>
          </div>
        </div>

        <div class="table-wrap">
          <div class="table-scroll">
            <table id="filetbl">
              <thead>
                <tr>
                  <th>filehash</th>
                  <th>filename</th>
                  <th>filesize</th>
                  <th>updatetime</th>
                  <th>lastupdate</th>
                  <th style="width:120px;">operation</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
    <div class="footer-links" style="display: flex; justify-content: center; align-items: center; height: 100px;">
      <p style="font-size: 12px;">© 2025 人性亦是白云苍狗，古往今来共一时</p>
    </div>
  </div>
  
</body>

<script lang="javascript">
  window.onload = function () {
    $.ajax({
      url: "/user/info?" + queryParams(),
      type: "GET",
      error: function (jqXHR, textStatus, errorThrown) {
        if (textStatus == "error") {
          alert(textStatus + " : " + errorThrown);
        } else {
          alert(textStatus);
        }
      },
      success: function (body, textStatus, jqXHR) {
        var resp = JSON.parse(body);
        document.getElementById("username").innerHTML = resp.data.Username;
        document.getElementById("regtime").innerHTML = resp.data.SignupAt;
        updateFileList();
      }
    });
  }

  function updateFileList() {
    $.ajax({
      url: "/file/query?" + queryParams(),
      type: "POST",
      data: {
        limit: 15
      },
      error: function (jqXHR, textStatus, errorThrown) {
        if (textStatus == "error") {
          alert(textStatus + " : " + errorThrown);
        } else {
          alert(textStatus);
        }
      },
      success: function (body, textStatus, jqXHR) {
        if (!body) return;

        var data = JSON.parse(body);
        if (!data || data.length <= 0) return;

        var tbl = document.getElementById('filetbl');
        var oldTbody = tbl.getElementsByTagName('tbody')[0];
        oldTbody.innerHTML = "";

        for (var i = 0; i < data.length; i++) {
          var row = oldTbody.insertRow();

          var cell = row.insertCell();
          cell.innerHTML = data[i].FileHash.substr(0, 20) + "...";

          cell = row.insertCell();
          cell.innerHTML = data[i].FileName;

          cell = row.insertCell();
          cell.innerHTML = data[i].FileSize;

          cell = row.insertCell();
          cell.innerHTML = data[i].UploadAt;

          cell = row.insertCell();
          cell.innerHTML = data[i].LastUpdated;

          cell = row.insertCell();
          cell.innerHTML =
            '<button class="btn btn-success" ' +
            'style="height:30px;margin:0;"' +
            'onClick="downloadFile(\'/file/download' +
            '?filename=' + encodeURIComponent(data[i].FileName) +
            '&filehash=' + encodeURIComponent(data[i].FileHash) +
            '&' + queryParams() + '\')">download</button>';

        }
      }
    });
  }

  function toUploadFile() {
    window.location.href = '/file/upload?' + queryParams();
  }

  function downloadFile(durl) {
    window.location.href = durl;
  }
</script>

</html>
